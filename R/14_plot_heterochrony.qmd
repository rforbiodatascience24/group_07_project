---
title: "Heterochrony, plots"
format: html
execute:
  echo: true
  output: false
---

We begin with loading the necessary libraries for plot formation:

```{r}
library("tidyverse")
library("broom")
library("patchwork")
```

Load the data sets.

```{r}
# Set path for processed data directory
processed_data_dir <- file.path("..","data")

# Load the data set and color palette
hum_chimp <- read_tsv(file = file.path(processed_data_dir,
                                         "08.1_hum_chi_hetchron.tsv"),
                      show_col_types = FALSE)
hum_mac <- read_tsv(file = file.path(processed_data_dir,
                                         "08.2_hum_mac_hetchron.tsv"),
                      show_col_types = FALSE)

color_palette <- read_tsv(file = file.path(processed_data_dir,
                                         "09_col_pal.tsv"),
                     show_col_types = FALSE)
```

```{r}
#hum_color <- color_palette |>
#  filter(group == "Species") |>
#  slice(1) |>
#  pull(color)

#chimp_color <- color_palette |>
#  filter(group == "Species") |>
#  slice(2) |>
#  pull(color)

#mac_color <- color_palette |>
#  filter(group == "Species") |>
#  slice(3) |>
#  pull(color)

# spec_color <- c(Human = hum_color,
#                Chimpanzee = chimp_color,
#                Macaque = mac_color)

altern_color <- color_palette |>
  filter(group == "Alternative") |>
  pull(color)

```

We wish to visualize the percentages of neotenic and accelerated genes from the humans shifted to chimps, and macaques. Therefore we start by argumentation of the heterochrony data from our earlier analysis, to find the percentages:

```{r}
hum_chimp_prep <- hum_chimp |>
  group_by(classification) |>
  count() |>
  ungroup() |>
  mutate(percent = (n / sum(n)) * 100,
         subject = "Human",
         shifted = "Chimpanzee")

hum_mac_prep <- hum_mac |>
  group_by(classification) |>
  count() |>
  ungroup() |>
  mutate(percent = (n / sum(n)) * 100,
         subject = "Human",
         shifted = "Macaque")

data_prep <- bind_rows(hum_chimp_prep,
                       hum_mac_prep)

view(data_prep)
```

We then create our plot to visualize the percentages:

```{r}
class_plot <- data_prep |>
  ggplot(map = aes(y = fct_reorder(interaction(subject, shifted),
                                   percent),
                   x = percent,
                   fill = classification)) +
  geom_bar(stat = "identity",
           position = position_dodge(),
           color = "black") +
  scale_x_continuous(limit = c(0,100)) +
  scale_y_discrete(labels = function(x) x) +
  theme_minimal() +
  theme(legend.title = element_blank(),
        plot.subtitle = element_markdown(),
        text = element_text(size = 12),
        plot.title.position = "plot",
        legend.position = "none",
        legend.direction = "vertical",
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.line.x = element_blank(),
        axis.ticks.x =element_blank()) +
  labs(title = "Gene Distribution", 
       subtitle = "by Phyloontogentic Catagories: <span style='color:#FDBF88'>Accelerated</span>,
       <span style='color:#F38B44'>Neotenic</span> and <span style='color:#DE580C'>Unclassified</span>",
       y = NULL,
       x = "Genes Assigned to Categories (%)") + 
  scale_fill_manual(values = altern_color)
  
print(class_plot)

```

Lastly, we write final plot to *.png* file.

```{r}
ggsave(file = file.path(processed_data_dir,
                        "14_test.png"),
       plot = class_plot,
       width = 12,
       height = 8)
```
